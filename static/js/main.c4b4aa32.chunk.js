(this["webpackJsonpmass-vocab-search-gh-pages"]=this["webpackJsonpmass-vocab-search-gh-pages"]||[]).push([[0],{21:function(e,t,n){},43:function(e){e.exports=JSON.parse('{"key":"1be91e33-f360-859c-bb8b-93d41b745d6c:fx"}')},52:function(e,t,n){},71:function(e,t,n){},76:function(e,t,n){},77:function(e){e.exports=JSON.parse("{}")},78:function(e,t,n){},79:function(e,t,n){},82:function(e,t,n){},85:function(e,t,n){"use strict";n.r(t);var i=n(0),s=n.n(i),a=n(15),r=n.n(a),c=(n(52),n(7)),o=n(8),d=n(10),l=n(9),u=n(46),h=n(5),f=(n(21),n(42)),p=n(17),j=n.n(p),b=n(22),x=n(19),g=n(20),m=n.n(g),v=n(25),O=n(18),y=(n(71),n(1)),k=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.call(this)}return Object(o.a)(n,[{key:"renderDefinition",value:function(e){if(e.definitions){console.log("detection",e);var t=e.definitions.map((function(e){console.log(e);var t=e.map((function(e){if(void 0!==e)return console.log("def",e),Object(y.jsx)("li",{children:e})}));return Object(y.jsx)(y.Fragment,{children:t})}));return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("div",{className:"part-of-speech",children:e.partOfSpeech}),Object(y.jsx)("ol",{children:t})]})}if(e.definition.translations.length>0){if(""===e.definition.translations[0]||void 0===e.definition.translations[0])return"no definition found :(";var n=e.definition.translations.map((function(e){return Object(y.jsx)("li",{children:e.text})}));return Object(y.jsx)("ol",{children:n})}return"no definition found :("}},{key:"detectImageRotation",value:function(){var e=this.props.detections[0],t=e.boundingPoly.vertices[0],n=e.boundingPoly.vertices[1],i=e.boundingPoly.vertices[3],s=e.boundingPoly.vertices[2];return n.x>t.x&&Math.abs(n.x-t.x)>Math.abs(n.x-s.x)?"right side up":(console.log("the image was flipped at some point during detection and I simply don't know why :/"),n.x<t.x&&Math.abs(n.x-t.x)>Math.abs(t.x-s.x)?(console.log("2 3\n1 0"),"upside-down"):i.x>n.x&&Math.abs(i.x-n.x)>Math.abs(n.x-t.x)?"rotated left":n.x>i.x&&Math.abs(n.x-i.x)>Math.abs(n.x-t.x)?(console.log("3 0\n2 1"),"rotated right"):void 0)}},{key:"renderDetectionsOnImage",value:function(){var e=this,t=this.detectImageRotation();return this.props.detections.map((function(n,i){var s=n.boundingPoly.vertices[0],a=n.boundingPoly.vertices[1],r=n.boundingPoly.vertices[3],c=n.boundingPoly.vertices[2],o=Math.min(s.y,a.y,r.y,c.y),d=Math.min(s.x,a.x,r.x,c.x),l=Math.max(s.y,a.y,r.y,c.y),u=Math.max(s.x,a.x,r.x,c.x),h=o,f=d,p=l-o,j=u-d;"right side up"!==t&&("rotated left"===t&&(h=d,f=e.props.imageWidth-l,p=u-d,j=l-o),"rotated right"===t&&(console.log("correcting right rotation"),h=d,f=e.props.imageWidth-l,p=u-d,j=l-o),"upside-down"===t&&(console.log("correcting upside-down rotation"),h=d,f=e.props.imageWidth-l,p=u-d,j=l-o));var b=Object(y.jsxs)(O.a,{className:"dynamic-text-size",id:n.description,children:[Object(y.jsx)(O.a.Title,{className:"large-dynamic-text-size",children:n.description}),Object(y.jsx)(O.a.Content,{children:e.renderDefinition(n)})]},n.description+h+"-popover"),x=window.innerHeight,g=window.innerHeight*(e.props.imageWidth/e.props.imageHeight),m=h/e.props.imageHeight*x,k=f/e.props.imageWidth*g,w=p/e.props.imageHeight*x,N=j/e.props.imageWidth*g;return Object(y.jsx)("div",{children:Object(y.jsx)(v.a,{placement:"top",overlay:b,children:Object(y.jsx)("div",{className:"text-overlay",style:{top:m,left:k,height:w,width:N}})},n.description)},n.description+h)}))}},{key:"render",value:function(){return Object(y.jsx)("div",{className:"ImageDetections",children:Object(y.jsxs)("div",{className:"img-box",children:[this.renderDetectionsOnImage(),Object(y.jsx)("img",{src:URL.createObjectURL(this.props.images[0]),height:window.innerHeight,top:"0px"})]})})}}]),n}(s.a.Component),w=(n(76),n(77),n(43)),N=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this)).state={img_files:null,img_buffers:null,imagesInput:!1,imagesParsed:!1,textDetections:null,definedDetections:null,detectionsLoaded:!1,imageWidth:0,imageHeight:0},e.changeImage=e.changeImage.bind(Object(x.a)(e)),e.setImageProps=e.setImageProps.bind(Object(x.a)(e)),e}return Object(o.a)(n,[{key:"changeImage",value:function(e){this.setState({img_files:e.target.files,img_type:".jpg",imagesInput:!0},this.parseFiles)}},{key:"parseFiles",value:function(){var e=Object(b.a)(j.a.mark((function e(){var t,n=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Array.from(this.state.img_files).map((function(e){return n.parseFile(e)})),Promise.all(t).then((function(e){n.setState({img_buffers:e,imagesParsed:!0},n.getOCR)}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setImageProps",value:function(e,t){this.setState({imageWidth:e,imageHeight:t})}},{key:"parseFile",value:function(){var e=Object(b.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.setImageProps,e.abrupt("return",new Promise((function(e){var i=new FileReader;i.addEventListener("load",(function(t){var s=new Image;s.src=t.target.result,s.onload=function(){n(this.width,this.height)},e(i.result)}),!1),i.readAsDataURL(t)})));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getOCR",value:function(){var e=Object(b.a)(j.a.mark((function e(){var t=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",m.a.post("https://us-east4-true-bit-315318.cloudfunctions.net/documentTextDetection",{img:this.state.img_buffers[0]}).then((function(e){t.setState({textDetections:e.data.textAnnotations,fullText:e.data.fullTextAnnotation},t.getDefinitions)})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDefinitions",value:function(){var e=Object(b.a)(j.a.mark((function e(){var t,n=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state.textDetections.map((function(e,t){if(0!==t){var n=e.description.replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"").toLowerCase();if(0!==n.length)return m.a.get("https://en.wiktionary.org/api/rest_v1/page/definition/".concat(n,"?redirect=false")).then((function(t){var n=t.data.ru[0].partOfSpeech,i=null,s='of <span class="form-of-definition-link"><i class="Cyrl mention" lang="ru"><a rel="mw:WikiLink" href="/wiki/',a=t.data.ru.map((function(e){var t=e.definitions;return t.map((function(e){var n=e.definition,a=n.indexOf(s);if(-1===a){var r=n.indexOf('<span class="form-of-definition use-with-mention'),c=n.indexOf('Letter "<span');if(-1===r&&-1===c)return n}else{var o=t[0].definition.slice(a+s.length);i=o.slice(0,o.indexOf("#Russian"))}}))}));return Object.assign(e,Object(f.a)({root:n,definitions:a.filter((function(e){return void 0!==e}))},"root",i)),e})).catch((function(e){404!==e.response.status&&console.error(e)}))}})),Promise.all(t).then((function(e){console.log("wiktionary results",e);var t=e.map((function(e){if(void 0!==e){if(null!==e.root)return m.a.get("https://en.wiktionary.org/api/rest_v1/page/definition/".concat(e.root,"?redirect=false")).then((function(t){return Object.assign(e,{rootDefinitions:t}),e})).catch((function(e){404!==e.response.status&&console.error(e)}));if(void 0===e.definitions){var t=e.description.replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"").toLowerCase();return m.a.get("https://api-free.deepl.com/v2/translate?auth_key=".concat(w.key,"&text=").concat(t,"&target_lang=EN")).then((function(t){return Object.assign(e,{definition:t.data}),e}))}return e}}));Promise.all(t).then((function(e){console.log("wiktionary + deepl results",e.filter((function(e){return void 0!==e}))),n.setState({definedDetections:e.filter((function(e){return void 0!==e})),detectionsLoaded:!0})}))}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.detectionsLoaded?Object(y.jsx)("div",{className:"ImageInput",children:Object(y.jsx)(k,{detections:this.state.definedDetections,images:this.state.img_files,imageWidth:this.state.imageWidth,imageHeight:this.state.imageHeight,fullText:this.state.fullText})}):this.state.imagesParsed?Object(y.jsxs)("div",{className:"ImageInput",children:["Loading image text...",Object(y.jsx)("div",{children:Object(y.jsx)("img",{src:this.state.img_buffers[0],height:.5*window.innerHeight})})]}):Object(y.jsx)("div",{className:"ImageInput",children:Object(y.jsx)("div",{children:Object(y.jsx)("input",{type:"file",id:"single",onChange:this.changeImage})})})}}]),n}(s.a.Component),S=(n(78),function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){return Object(y.jsx)("div",{className:"tracau-banner",children:Object(y.jsx)("a",{href:"https://tracau.vn",children:Object(y.jsx)("img",{src:"https://tracau.vn/assets/img/api/banner_white.png",alt:"Powered by tra c\xe2u"})})})}}]),n}(s.a.Component)),I=(n(79),n(44)),P=n(45),C=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this)).state={text:""},e}return Object(o.a)(n,[{key:"detectHotkeySubmit",value:function(e,t){e.shiftKey&&"Enter"===e.key&&this.props.submitSearch(t)}},{key:"render",value:function(){var e=this;return Object(y.jsxs)("div",{className:"InputText",children:[Object(y.jsxs)("div",{className:"main-content",children:[Object(y.jsx)("div",{children:"Enter text: "}),Object(y.jsxs)("div",{className:"upper-flex",onKeyPress:function(t){return e.detectHotkeySubmit(t,e.state.text)},children:[Object(y.jsx)("textarea",{className:"big-textbox",value:this.state.text,onChange:function(t){return e.setState({text:t.target.value})}}),Object(y.jsx)(I.a,{icon:P.a,onClick:function(t){return e.props.submitSearch(e.state.text)}})]})]}),Object(y.jsx)(S,{})]})}}]),n}(s.a.Component),L=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){return this.props.defnsList[0].startsWith("See ")?this.defnsList=this.props.defnsList.slice(1):this.defnsList=this.props.defnsList,Object(y.jsx)("div",{className:"Definition",children:Object(y.jsx)("ol",{children:this.defnsList.map((function(e){return Object(y.jsx)("li",{children:e})}))})})}}]),n}(s.a.Component),_=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var e=Object(y.jsxs)(O.a,{id:this.props.word,children:[Object(y.jsx)(O.a.Title,{as:"h3",children:this.props.word}),Object(y.jsx)(O.a.Content,{children:Object(y.jsx)(L,{defnsList:this.props.defn})})]});return Object(y.jsx)("div",{className:"DefinedWord",children:Object(y.jsx)(v.a,{placement:"top",overlay:e,children:Object(y.jsx)("div",{children:this.props.word})},this.props.word)})}}]),n}(s.a.Component),T=(n(82),function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this)).state={isLoaded:!1,searchResults:{}},e}return Object(o.a)(n,[{key:"search",value:function(e){var t=this,n=e.split(/[ X\n]/),i={},s=n.map((function(e,s){return t.searchCompoundWord(n,s).then((function(t){if(t&&t.length>0&&!t[0].startsWith("See "))return i[e+" "+n[s+1]]=t,Promise.resolve()}))}));return Promise.all(s).then((function(){var e=Object.assign({},i);console.log("compound definitions:",e);var s=n.map((function(s,a){var r=n[a-1]+" "+s,c=s+" "+n[a+1];return r in i||c in i?Promise.resolve():t.tracauSearch(s).then((function(t){return t&&t.length>0&&(e[s]=t),Promise.resolve()}))}));return Promise.all(s).then(e)}))}},{key:"searchCompoundWord",value:function(e,t){return e.length>t+1?this.tracauSearch(e[t]+" "+e[t+1]):Promise.resolve()}},{key:"tracauSearch",value:function(e){var t=e.trim().replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"");return m.a.get("https://api.tracau.vn/"+D+"/s/"+t+"/vi").then((function(e){if(e.data.tratu.length<=0)return!1;var t=e.data.tratu[0].fields.fulltext,n=t.indexOf('<article id="dict_vv" data-tab-name="Vi\u1ec7t - Anh"'),i=t.slice(n),s=i.indexOf("</article>"),a='<table id="definition_T_ve_id" border="0">',r=(i=i.slice(0,s)).indexOf(a)+a.length,c=i.slice(r),o=c.indexOf("</table>"),d=(c=c.slice(0,o)).split('<td id="I_C"><font color="#999">\u25a0</font></td><td id="C_C" colspan="2">'),l=[];return d.slice(1).forEach((function(e){var t=e.slice(0,e.indexOf("</td>")),n='Xem <font color="#1371BB">',i=t.indexOf("</font>");(t.startsWith(n)||t.startsWith('xem <font color="#1371BB">'))&&(t="See "+t.slice(n.length,i)),l.push(t)})),l}))}},{key:"componentDidMount",value:function(){var e=this;this.search(this.props.text).then((function(t){console.log("search results",t),e.setState({isLoaded:!0,searchResults:t})}))}},{key:"render",value:function(){var e=this,t=Object(y.jsxs)("div",{className:"footer",children:[Object(y.jsx)("div",{className:"submit-search",children:Object(y.jsx)("button",{onClick:this.props.returnToSearch,children:"Search again"})}),Object(y.jsx)(S,{})]});return""===this.props.text?Object(y.jsxs)("div",{className:"SearchedText",children:[Object(y.jsx)("div",{className:"text-display",children:Object(y.jsx)("div",{className:"vertical-centered",children:Object(y.jsx)("div",{children:"Oops! Looks like no text was input. Would you like to search again?"})})}),t]}):this.state.isLoaded?Object(y.jsxs)("div",{className:"SearchedText",children:[Object(y.jsx)("div",{className:"text-display",children:Object(y.jsx)("div",{className:"vertical-centered",children:Object(y.jsx)("div",{className:"words-and-definitions",children:this.props.text.split(/[ X\n]/).map((function(t,n){if(-1!==n){var i=t+" "+e.props.text.split(/[ X\n]/)[n+1];if(i in e.state.searchResults){var s=e.state.searchResults[i];return Object(y.jsx)(_,{word:i,defn:s},n)}if(t in e.state.searchResults){var a=e.state.searchResults[t];return Object(y.jsx)(_,{word:t,defn:a},n)}return Object(y.jsx)("div",{className:"definition-not-found",children:t},n)}}))})})}),t]}):Object(y.jsxs)("div",{className:"SearchedText",children:[Object(y.jsx)("div",{className:"text-display",children:Object(y.jsx)("div",{className:"vertical-centered",children:"loading..."})}),t]})}}]),n}(s.a.Component)),D="WBBcwnwQpV89",W=T,R=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this)).state={searched:!1,searchedText:""},e.toggleSearch=e.toggleSearch.bind(Object(x.a)(e)),e}return Object(o.a)(n,[{key:"toggleSearch",value:function(e){this.setState((function(t){return{searched:!t.searched,searchedText:e}}))}},{key:"render",value:function(){var e=this;return this.state.searched?Object(y.jsx)("div",{className:"TextInput",children:Object(y.jsx)(W,{text:this.state.searchedText,returnToSearch:function(t){return e.toggleSearch("")}})}):Object(y.jsx)("div",{className:"TextInput",children:Object(y.jsx)("header",{className:"App-header",children:Object(y.jsx)(C,{submitSearch:this.toggleSearch})})})}}]),n}(s.a.Component),M=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){return Object(y.jsx)("div",{className:"App",children:Object(y.jsx)(u.a,{children:Object(y.jsxs)(h.c,{children:[Object(y.jsx)(h.a,{path:"/text",component:R}),Object(y.jsx)(h.a,{path:"/img",component:N}),Object(y.jsx)(h.a,{exact:!0,path:"/",component:R})]})})})}}]),n}(s.a.Component),H=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,90)).then((function(t){var n=t.getCLS,i=t.getFID,s=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),i(e),s(e),a(e),r(e)}))};r.a.render(Object(y.jsx)(s.a.StrictMode,{children:Object(y.jsx)(M,{})}),document.getElementById("root")),H()}},[[85,1,2]]]);
//# sourceMappingURL=main.c4b4aa32.chunk.js.map